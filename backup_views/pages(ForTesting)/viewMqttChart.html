<!DOCTYPE html>
<html lang="en">
<head>
    <title>Chart.js Mqtt Viewer</title>
</head>
<body>
    <canvas id="line-chart1" width="600" height="400"></canvas>
    <canvas id="line-chart2" width="600" height="400"></canvas>
    <canvas id="line-chart3" width="600" height="400"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var ctx = document.getElementById("line-chart").getContext("2d");
        var chart;
        chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Data",
                fill:true,
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1,
                pointHoverBorderColor:"red",
                data: []
              },
              {
                label: "Data2",
                fill:true,
                backgroundColor: "lightgreen",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1,
                pointHoverBorderColor:"red",
                data: []
              }
            ]
          },
          options: {
            responsive: false,
            maintainAspectRatio: false,
            spanGaps:10,
            scales: {
              xAxes: [
                {
                  type: "time",
                  distribution: "linear",
                  ticks: {
                    source: "labels"
                  },
                  min: new Date(),
                  max: new Date() + 5,
                }
              ],
              yAxes: [
                {
                  display: true
                }
              ]
            },
            tooltips: {
              mode: "index",
              intersect: false,
              callbacks: {
                label: function(tooltipItem, data) {
                return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel;
                }
              }
            },
            hover: {
              mode: "index",
              intersect: false
            }
          }
        });
        const socket = io();
        socket.on("message_mqtt", function(data) {
          console.log(data);
          updateChart(data.msg);
        });
    </script>
    <script>
    
      function updateChart(data) {
        var currentDate = new Date();
        var hours = currentDate.getHours();
        var minutes = currentDate.getMinutes();
        var seconds = currentDate.getSeconds();
        var time = hours + ":" + minutes + ":" + seconds;
    
        chart.data.labels.push(time);
        chart.data.datasets[0].data.push(data.data1);
        chart.data.datasets[1].data.push(data.data2);
        chart.update();
      }

    </script>
</body>
</html>
